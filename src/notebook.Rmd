---
title: "R Notebook"
output: html_notebook
---


```{r}
library(arrow)
library(tidyverse)
library(here)
corpus <- open_dataset(here("data/corpus.parquet")) |> to_duckdb()
metadata <- open_dataset(here("data/corpus_meta.parquet")) |> to_duckdb()
inferred <- open_dataset(here("data/corpus_inferred.parquet")) |> to_duckdb()
```


```{r}
full_corpus <- corpus |>
  left_join(metadata, join_by(text_id)) |> 
  select(-original_token_number_start, -original_token_number_end) |>
  left_join(inferred |> mutate(inferred=T), join_by(original_token_number>=original_token_number_start, original_token_number<original_token_number_end)) |> 
  select(-original_token_number_start, -original_token_number_end) |>
  replace_na(list(inferred=F))

full_corpus
```

```{r}
metadata |>
  count(year) |>
  ggplot(aes(x=year, y=n)) + 
  geom_step()
```

